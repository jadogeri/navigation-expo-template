import React, { useState, useCallback, useEffect } from 'react';
import { View, Platform, StyleSheet } from 'react-native';
import { GiftedChat, IMessage, User } from 'react-native-gifted-chat';
import { SafeAreaView, useSafeAreaInsets } from 'react-native-safe-area-context';
// You may need react-native-vector-icons for certain custom components
// import Ionicons from 'react-native-vector-icons/Ionicons'; 

const currentUser: User = {
  _id: 'user1',
  name: 'Current User',
};

const ChatScreen2: React.FC = () => {
  const [messages, setMessages] = useState<IMessage[]>([]);
  const insets = useSafeAreaInsets(); // Helps with safe area on newer devices

  useEffect(() => {
    // Set initial messages upon component mount
    setMessages([
      {
        _id: '1',
        text: 'Hello developer! This is a message from the other user.',
        createdAt: new Date(),
        user: {
          _id: 'user2',
          name: 'React Native User',
          avatar: 'placeimg.com',
        },
      },
    ]);
  }, []);

  // Callback function to handle sending messages
  const onSend = useCallback((messagesToSend: IMessage[] = []) => {
    setMessages(previousMessages =>
      GiftedChat.append(previousMessages, messagesToSend),
    );
    // In a real app, you would send the messagesToSend to your backend here
    // e.g., API.sendMessage(messagesToSend[0])
  }, []);

  return (
    <SafeAreaView style={styles.container}>
      <GiftedChat
        messages={messages}
        onSend={messages => onSend(messages)}
        user={currentUser}
        //placeholder="Type a message..."
        // Adjusts the keyboard avoiding offset, especially for iOS
        //keyboardVerticalOffset={Platform.select({ ios: insets.bottom + 44, default: 0 })}
        // Example of adding a system message functionality
        // renderSystemMessage={(props) => <Text>---{props.currentMessage.text}---</Text>}
      />
    </SafeAreaView>
  );
};

const styles = StyleSheet.create({
  container: {
    flex: 1,
    backgroundColor: '#fff',
  },
});

export default ChatScreen2;
